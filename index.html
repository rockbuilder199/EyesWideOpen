<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Learning Compound</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/forms.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>The Learning Compound</h1>
        </div>

        <!-- Data Management Section -->
        <div class="card" style="margin-bottom: 20px; background: rgba(255,255,255,0.08);">
            <h2 style="font-size: 1.3rem; margin-bottom: 15px;">Data Management</h2>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-secondary" onclick="exportData()">üì• Export Data</button>
                <button class="btn btn-secondary" onclick="showImportModal()">üì§ Import Data</button>
                <button class="btn btn-danger" onclick="clearAllData()" style="margin-left: auto;">üóëÔ∏è Clear All Data</button>
            </div>
            <p style="font-size: 0.85rem; opacity: 0.7; margin-top: 10px;">
                Export your data to save it or share it on GitHub. Import to load data from a JSON file.
            </p>
        </div>

        <div class="card">
            <div class="topics-header">
                <h2>Topics</h2>
                <div class="topics-controls">
                    <select id="topicSort" class="topic-sort-dropdown" onchange="sortTopics(this.value)">
                        <option value="alphabetical">Sort Alphabetically</option>
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                    </select>
                    <button class="btn" onclick="showAddTopicModal()">Add Topic</button>
                </div>
            </div>
            <ul class="item-list compact-list" id="topicsList"></ul>
        </div>
    </div>

    <!-- Add Topic Modal -->
    <div id="topicModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('topicModal')">&times;</span>
            <h2>Add New Topic</h2>
            <form id="topicForm" onsubmit="addTopic(event)">
                <div class="form-group">
                    <label for="topicName">Topic Name:</label>
                    <input type="text" id="topicName" required>
                </div>
                <button type="submit" class="btn">Add Topic</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('topicModal')">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Import Data Modal -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('importModal')">&times;</span>
            <h2>Import Data</h2>
            <div class="form-group">
                <label for="importFile">Select JSON File:</label>
                <input type="file" id="importFile" accept=".json" onchange="handleImportFile(event)">
            </div>
            <p style="font-size: 0.9rem; opacity: 0.8; margin-top: 15px;">
                ‚ö†Ô∏è Warning: Importing will replace all current data. Export your current data first if you want to keep it.
            </p>
            <button type="button" class="btn btn-secondary" onclick="closeModal('importModal')">Cancel</button>
        </div>
    </div>

    <script src="js/storage.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Export data to JSON file
        function exportData() {
            const data = storage.exportData();
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'learning-compound-data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('Data exported successfully! Save this file to your project\'s data/ folder for GitHub.');
        }

        // Show import modal
        function showImportModal() {
            const modal = document.getElementById('importModal');
            const input = document.getElementById('importFile');
            if (input) input.value = '';
            if (modal) modal.style.display = 'block';
        }

        // Handle import file selection
        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const jsonData = e.target.result;
                    if (storage.importData(jsonData)) {
                        alert('Data imported successfully!');
                        closeModal('importModal');
                        app.renderTopics();
                        location.reload();
                    } else {
                        alert('Failed to import data. Please check the file format.');
                    }
                } catch (error) {
                    alert('Error importing data: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // Clear all data
        function clearAllData() {
            if (confirm('‚ö†Ô∏è WARNING: This will delete ALL topics, modules, flashcards, and videos.\n\nThis action cannot be undone. Are you sure?')) {
                if (confirm('Last chance! Really delete everything?')) {
                    storage.clearAllData();
                    alert('All data has been cleared.');
                    location.reload();
                }
            }
        }
    </script>
</body>
</html>